# -*- coding: utf-8 -*-
import streamlit as st
import pandas as pd
from random import choices, sample, randint

# 1. é…ç½®é—®å·é—®é¢˜å’Œé€‰é¡¹
questions = {
    # åŸºæœ¬ä¿¡æ¯
    "Q1_èº«ä»½": ["æ¯äº²", "çˆ¶äº²", "ç¥–çˆ¶æ¯", "å…¶ä»–äº²å±"],
    "Q2_å¹´é¾„": ["25å²åŠä»¥ä¸‹", "26-30å²", "31-35å²", "36-40å²", "41å²åŠä»¥ä¸Š"],
    "Q3_å­¦å†": ["åˆä¸­åŠä»¥ä¸‹", "é«˜ä¸­/ä¸­ä¸“", "å¤§ä¸“", "æœ¬ç§‘", "ç¡•å£«åŠä»¥ä¸Š"],
    
    # æ•™è‚²è§‚å¿µ
    "Q4_èƒ½åŠ›åŸ¹å…»": ["çŸ¥è¯†å­¦ä¹ ", "åˆ›é€ åŠ›", "è§„åˆ™æ„è¯†", "æƒ…ç»ªç®¡ç†", "è¿åŠ¨èƒ½åŠ›", "è‰ºæœ¯å…´è¶£"],
    "Q5_æ•™è‚²æ–¹æ³•": ["è€å¿ƒè®²é“ç†", "å…±åŒè®¨è®º", "æ‰¹è¯„è´£å¤‡", "å†·å¤„ç†"],
}

# 2. è®¾ç½®è®ºæ–‡ä¸­çš„ç²¾ç¡®æ•°æ®åˆ†å¸ƒ
distributions = {
    # åŸºæœ¬ä¿¡æ¯åˆ†å¸ƒï¼ˆç™¾åˆ†æ¯”ï¼‰
    "Q1_èº«ä»½": [68, 25, 5, 2],  # æ¯äº²68%ï¼Œçˆ¶äº²25%...
    "Q2_å¹´é¾„": [3, 7, 40, 30, 20],
    "Q3_å­¦å†": [5, 20, 25, 45, 5],
    
    # å¤šé€‰é¢˜åˆ†å¸ƒï¼ˆé€‰æ‹©æ¦‚ç‡ï¼‰
    "Q4_èƒ½åŠ›åŸ¹å…»": [35, 52, 48, 45, 28, 15],  # å¯¹åº”é€‰é¡¹é¡ºåº
    "Q5_æ•™è‚²æ–¹æ³•": [65, 58, 12, 8],  # ç™¾åˆ†æ¯”
}

# 3. æ•°æ®ç”Ÿæˆæ ¸å¿ƒå‡½æ•°
def generate_data(num=312):
    data = []
    for _ in range(num):
        record = {}
        
        # ç”Ÿæˆå•é€‰é¢˜
        for q in ["Q1_èº«ä»½", "Q2_å¹´é¾„", "Q3_å­¦å†"]:
            record[q] = choices(questions[q], weights=distributions[q])[0]
        
        # ç”Ÿæˆå¤šé€‰é¢˜ï¼ˆæœ€å¤šé€‰3é¡¹ï¼‰
        record["Q4_èƒ½åŠ›åŸ¹å…»"] = "|".join(sample(
            questions["Q4_èƒ½åŠ›åŸ¹å…»"],
            counts=distributions["Q4_èƒ½åŠ›åŸ¹å…»"],
            k=randint(1, 3)  # éšæœºé€‰1-3é¡¹
        ))
        
        # ç”Ÿæˆæ•™è‚²æ–¹æ³•é€‰æ‹©
        record["Q5_æ•™è‚²æ–¹æ³•"] = choices(
            questions["Q5_æ•™è‚²æ–¹æ³•"],
            weights=distributions["Q5_æ•™è‚²æ–¹æ³•"]
        )[0]
        
        data.append(record)
    return pd.DataFrame(data)

# 4. åˆ›å»ºç½‘é¡µç•Œé¢
st.set_page_config(page_title="è®ºæ–‡é—®å·æ•°æ®ç”Ÿæˆå™¨", layout="wide")
st.title("ğŸ“ å®¶é•¿æ•™è‚²è§‚å¿µé—®å·æ•°æ®ç”Ÿæˆç³»ç»Ÿ")
st.write("æ ¹æ®æ‚¨è®ºæ–‡ä¸­çš„åˆ†å¸ƒè¦æ±‚è‡ªåŠ¨ç”Ÿæˆé—®å·æ˜Ÿæ ¼å¼æ•°æ®")

# ä¾§è¾¹æ æ§åˆ¶
with st.sidebar:
    st.header("æ§åˆ¶é¢æ¿")
    num = st.number_input("ç”Ÿæˆæ•°æ®é‡", min_value=1, value=312)
    btn = st.button("ç”Ÿæˆæ•°æ®", type="primary")

# ä¸»ç•Œé¢
if btn:
    df = generate_data(num)
    st.success(f"æˆåŠŸç”Ÿæˆ {num} æ¡æ•°æ®ï¼")
    
    # æ˜¾ç¤ºæ•°æ®é¢„è§ˆ
    st.dataframe(df.head())
    
    # ä¸‹è½½CSVæ–‡ä»¶
    csv = df.to_csv(index=False, encoding="utf_8_sig")  # ä¸­æ–‡ç¼–ç 
    st.download_button(
        label="ä¸‹è½½CSVæ–‡ä»¶",
        data=csv,
        file_name="é—®å·æ•°æ®.csv",
        mime="text/csv"
    )
